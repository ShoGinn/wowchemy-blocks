name: 'Generate and deploy'
# From https://swharden.com/blog/2022-03-20-github-actions-hugo/
on:
  workflow_dispatch:
  push:
env:
  LANG: 'en_US.UTF-8'
  LANGUAGE: 'en_US:en'
  LC_ALL: 'en_US.UTF-8'
jobs:
  quality:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        hugo-version:
          - 'latest'

    steps:
      - uses: actions/checkout@v3

      - name: Setup Hugo 💡
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: ${{ matrix.hugo-version }}
          extended: true

      - name: Proof HTML 📚
        run: hugo --gc --minify -e production -v -b https://example.com/

      - name: Check HTML
        uses: chabad360/htmlproofer@master
        with:
          directory: './public'
          arguments: --allow-hash-href=true --ignore-empty-alt=true --disable-external=true --ignore-empty-mailto=true
  release:
    runs-on: ubuntu-latest
    needs:
      - quality
    steps:
      - uses: google-github-actions/release-please-action@v3
        with:
          release-type: node
          package-name: release-please-action

  # deploy:
  #   name: Deploy to site.
  #   runs-on: ubuntu-latest
  #   needs:
  #     - quality
  #   steps:
  #     - name: 🛒 Checkout
  #       uses: actions/checkout@v3
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #     - name: ✨ Setup Hugo
  #       uses: peaceiris/actions-hugo@v2
  #       with:
  #         hugo-version: "latest"
  #         extended: true
  #     - name: 🛠️ Build
  #       run: hugo --gc --minify -e production -b https://ginn.space/
  #     - name: 🔑 Install SSH Key
  #       uses: shimataro/ssh-key-action@v2
  #       with:
  #         key: ${{ secrets.VPS_DEPLOY_KEY }}
  #         known_hosts: ${{ secrets.SSH_HOSTS }}
  #     - name: 🚀 Deploy
  #       run: rsync -arvzc --delete --stats -e 'ssh -p ${{ secrets.SSH_PORT }}' 'public/' ${{ secrets.REMOTE_DEST }}
